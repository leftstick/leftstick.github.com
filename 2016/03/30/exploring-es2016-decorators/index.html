<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>[译]揭秘ES2016中的Decorators | 右领军大都督</title>
    <meta name="description" content="迭代器(iterators)、生成器(generators)、数组推导式([array comprehensions](https://developer.mozilla.or ...">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.ff698ad4.css" as="style"><link rel="preload" href="/assets/js/app.66fd165c.js" as="script"><link rel="preload" href="/assets/js/6.1b9a181a.js" as="script"><link rel="preload" href="/assets/js/4.718a8abf.js" as="script"><link rel="preload" href="/assets/js/33.9948fc6c.js" as="script"><link rel="prefetch" href="/assets/js/1.836aefc7.js"><link rel="prefetch" href="/assets/js/10.5978e5d8.js"><link rel="prefetch" href="/assets/js/11.ec890499.js"><link rel="prefetch" href="/assets/js/12.db7bcb86.js"><link rel="prefetch" href="/assets/js/13.a0678d0c.js"><link rel="prefetch" href="/assets/js/14.db66846d.js"><link rel="prefetch" href="/assets/js/15.2591b2da.js"><link rel="prefetch" href="/assets/js/16.80583441.js"><link rel="prefetch" href="/assets/js/17.0753be43.js"><link rel="prefetch" href="/assets/js/18.72780206.js"><link rel="prefetch" href="/assets/js/19.1d487c74.js"><link rel="prefetch" href="/assets/js/20.f0fe9a95.js"><link rel="prefetch" href="/assets/js/21.d80a0f41.js"><link rel="prefetch" href="/assets/js/22.4695553f.js"><link rel="prefetch" href="/assets/js/23.52e4eec9.js"><link rel="prefetch" href="/assets/js/24.bf9c9350.js"><link rel="prefetch" href="/assets/js/25.5eb98d81.js"><link rel="prefetch" href="/assets/js/26.17cf0ede.js"><link rel="prefetch" href="/assets/js/27.522aaf5a.js"><link rel="prefetch" href="/assets/js/28.f0f1746b.js"><link rel="prefetch" href="/assets/js/29.7185f335.js"><link rel="prefetch" href="/assets/js/30.84d20b8c.js"><link rel="prefetch" href="/assets/js/31.c51c0b21.js"><link rel="prefetch" href="/assets/js/32.7d842090.js"><link rel="prefetch" href="/assets/js/34.03615f5c.js"><link rel="prefetch" href="/assets/js/35.916ec328.js"><link rel="prefetch" href="/assets/js/36.573317d5.js"><link rel="prefetch" href="/assets/js/37.766086c8.js"><link rel="prefetch" href="/assets/js/38.b2d6547e.js"><link rel="prefetch" href="/assets/js/39.f52d00bf.js"><link rel="prefetch" href="/assets/js/40.fffe6b1e.js"><link rel="prefetch" href="/assets/js/41.d2951850.js"><link rel="prefetch" href="/assets/js/42.1d2dcebb.js"><link rel="prefetch" href="/assets/js/43.8e48cd61.js"><link rel="prefetch" href="/assets/js/44.8303cf21.js"><link rel="prefetch" href="/assets/js/45.39ad8d71.js"><link rel="prefetch" href="/assets/js/5.6e87a095.js"><link rel="prefetch" href="/assets/js/7.01c41c5e.js"><link rel="prefetch" href="/assets/js/8.b9ecde8b.js"><link rel="prefetch" href="/assets/js/9.a3929d94.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.da6e1ebe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ff698ad4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">右领军大都督 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">右领军大都督 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        [译]揭秘ES2016中的Decorators
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">Howard Zuo</span> <span itemprop="address">   in Shanghai</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2016-03-30T00:00:00.000Z">
      Wed Mar 30 2016
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-d832e844><a href="/tag/ES2016" data-v-d832e844> ES2016 </a></li><li class="post-tag" data-v-d832e844><a href="/tag/Decorators" data-v-d832e844> Decorators </a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>迭代器(<a href="https://jakearchibald.com/2014/iterators-gonna-iterate/" target="_blank" rel="noopener noreferrer">iterators<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)、生成器(<a href="http://www.2ality.com/2015/03/es6-generators.html" target="_blank" rel="noopener noreferrer">generators<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)、数组推导式(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Array_comprehensions" target="_blank" rel="noopener noreferrer">array comprehensions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>); 随着JavaScript与Python之间的相似度与日俱增，对于这种变化，我绝对是最high的那个。那今天我们就来聊聊又一个<code>Python</code>化在ES2016(也叫ES7)里的体现——装饰器(Decorators)，by Yehuda Katz</p> <h2 id="装饰器模式"><a href="#装饰器模式" class="header-anchor">#</a> 装饰器模式</h2> <p>装饰器(Decorator)到底是个什么鬼？来让我们从头儿说，在<code>Python</code>里，装饰器(Decorator)是一种极简的调用高阶函数(higher-order function)的语法。<code>Python</code>里，装饰器(Decorator)就是一个函数，她接受另一个函数作为参数，然后在不直接修改这个函数的情况下，扩展该函数的行为，最终再将该函数返回。<code>Python</code>里一个最简单的装饰器(Decorator)使用起来长这个样子：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@mydecorator</span>
<span class="token keyword">def</span> <span class="token function">myfunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre></div><p>最上面那个(<code>@mydecorator</code>)就是一个装饰器(Decorator)，而且和ES2016(ES7)里的装饰器(Decorator)在特征上没什么区别，所以这里就要注意喽！</p> <p><code>@</code>符号告诉解析器我们正在使用一个名叫<code>mydecorator</code>的装饰器(Decorator)，并且<code>mydecorator</code>就是真实的这个装饰器(Decorator)的定义函数的名字。装饰器(Decorator)要做的就是接受一个参数（那个即将被&quot;装饰&quot;的函数），封装额外功能，然后返回原被装饰的函数。</p> <p>当你不想修改一个函数，又想通过该函数的输入、输出做点儿额外工作的时候，装饰器(Decorator)就显得格外耀眼了。这类功能常见于：缓存、访问控制、鉴权、监控、计/定时器、日志、级别控制等等。</p> <h2 id="es5、es2015-es6-里的装饰器-decorator"><a href="#es5、es2015-es6-里的装饰器-decorator" class="header-anchor">#</a> ES5、ES2015(ES6)里的装饰器(Decorator)</h2> <p>ES5里，想要通过纯粹的函数实现一个装饰器(Decorator)，很麻烦！从ES2015(ES6)开始，类原生支持继承，我们就需要一种更好的方式在多个类之间共享同一段代码功能。一种更好的分配法。</p> <p>Yehuda在他的的提议里认为通过装饰器(Decorator)在设计阶段使用注解(annotating)、修改JavaScript类、属性和字面量对象等方式来保持代码的优雅。有兴趣的朋友看这里：<a href="https://github.com/wycats/javascript-decorators" target="_blank" rel="noopener noreferrer">Yehuda's Decorator Proposal<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>下面还是让我们一起用ES2016(ES7)的装饰器(Decorator)来试试拳脚吧！</p> <h2 id="上手es2016的装饰器-decorator"><a href="#上手es2016的装饰器-decorator" class="header-anchor">#</a> 上手ES2016的装饰器(Decorator)</h2> <p>先回顾一下我们在<code>Python</code>里学到的东东。ES2016(ES7)里的装饰器(decorator)是这样一个表达式，她会返回一个函数，这个函数接受三个参数，分别是：<code>target</code>、<code>name</code>、<code>property descriptor</code>。我们通过给这个表达式加前缀<code>@</code>，并且将这段表达式放在想要“装饰”的内容上面。装饰器(Decorator)可以通过类或者属性来定义。</p> <h3 id="装饰一个属性"><a href="#装饰一个属性" class="header-anchor">#</a> 装饰一个属性</h3> <p>下面是一个简单的<code>Cat</code>类：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Cat</span><span class="token punctuation">{</span>
    <span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> says Meow!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>用<code>prototype</code>的方式定义这个类，在<code>Cat.prototype</code>上增加<code>meow</code>方法，大概是这个样子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'meow'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> specifiedFunction<span class="token punctuation">,</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    writable<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我们想要一个属性或者方法不可被<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Assignment_Operators" target="_blank" rel="noopener noreferrer">赋值运算符<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>改变。放一个装饰器(Decorator)在这个属性上面就行。我们来写一个<code>@readonly</code>装饰器(Decorator)：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">readonly</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    descriptor<span class="token punctuation">.</span>writable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> descriptor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后，把这个装饰器(Decorator)加在<code>meow</code>属性上：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Cat</span><span class="token punctuation">{</span>
    @readonly
    <span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> says Meow!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>装饰器(Decorator)是一个会被执行的表达式，她还必须再返回一个函数。意思是，<code>@readonly</code>或者<code>@something(parameter)</code>都可以是合法的装饰器(Decorator)。</p> <p>那么，在<code>property descriptor</code>被注册到<code>Cat.prototype</code>之前，执行引擎会先执行装饰器(Decorator)：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> descriptor <span class="token operator">=</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> specifiedFunction<span class="token punctuation">,</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    writable<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//装饰器和`Object.defineProperty`具有相同的参数列表，</span>
<span class="token comment">//有机会在真正的`defineProperty`之行之前做点儿事情</span>
descriptor <span class="token operator">=</span> <span class="token function">readonly</span><span class="token punctuation">(</span><span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'meow'</span><span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span> <span class="token operator">||</span> descriptor<span class="token punctuation">;</span>
<span class="token function">defineDecoratedProperty</span><span class="token punctuation">(</span><span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'meow'</span><span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>就这样，<code>meow</code>现在成了只读参数。来用以下代码验证我们的实现：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> garfield <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

garfield<span class="token punctuation">.</span><span class="token function-variable function">meow</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'I want lasagne!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//Exception: Attempted to assign to readonly property</span>
</code></pre></div><p>碉堡了，有木有？待会儿我们就来瞧瞧如何装饰一个类(只玩儿属性是不是有点儿low)。不过我们还是先来看一个类库(<a href="https://github.com/jayphelps/core-decorators.js" target="_blank" rel="noopener noreferrer">https://github.com/jayphelps/core-decorators.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> by Jay Phelps)。尽管她还年轻，不过ES2016里的装饰器(Decorator)已经都可以通过她使用了哦。</p> <p>和上面我们写的给<code>meow</code>属性的<code>@readonly</code>装饰器一样，她已内置了<code>@readonly</code>实现，引入即可使用：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> readonly <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'core-decorators'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Meal</span><span class="token punctuation">{</span>
    @readonly
    entree <span class="token operator">=</span> <span class="token string">'steak'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> dinner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dinner<span class="token punctuation">.</span>entree <span class="token operator">=</span> <span class="token string">'salmon'</span><span class="token punctuation">;</span>
<span class="token comment">//Cannot assign to read only property 'entree' of [object Object]</span>
</code></pre></div><p><code>core-decorators</code>里面还有其他常用的装饰器(Decorator)工具，譬如：<code>@deprecate</code>，当API需要一些变更提示信息时，可以写成这样：</p> <blockquote><p>调用<code>console.warn()</code>输出废弃提示信息。你也能传入一个自定义的信息覆盖默认值。甚至还可以给一个包含<code>url</code>的options对象，让用户可以了解更多</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> deprecate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'core-decorators'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
    @deprecate
    <span class="token function">facepalm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    @<span class="token function">deprecate</span><span class="token punctuation">(</span><span class="token string">'We stopped facepalming'</span><span class="token punctuation">)</span>
    <span class="token function">facepalmHard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    @<span class="token function">deprecate</span><span class="token punctuation">(</span><span class="token string">'We stopped facepalming'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">'http://knowyourmeme.com/memes/facepalm'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">facepalmHarder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> captainPicard <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

captainPicard<span class="token punctuation">.</span><span class="token function">facepalm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//DEPRECATION Person#facepalm: This function will be removed in future versions.</span>

captainPicard<span class="token punctuation">.</span><span class="token function">facepalmHard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//DEPRECATION Person#facepalmHard: We stopped facepalming</span>

captainPicard<span class="token punctuation">.</span><span class="token function">facepalmHarder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//DEPRECATION Person#facepalmHarder: We stopped facepalming</span>
<span class="token comment">//</span>
<span class="token comment">//     see: http://knowyourmeme.com/memes/facepalm for more details.</span>
<span class="token comment">//</span>
</code></pre></div><h3 id="装饰一个类"><a href="#装饰一个类" class="header-anchor">#</a> 装饰一个类</h3> <p>下面我们再来看看如何装饰一个类。在下面这个例子中，标准提议中称装饰器(Decorator)也能接受一个构造器。有一个小说类<code>MySuperHero</code>，我们来为她写一个简单的<code>@superhero</code>装饰器：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">superhero</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    target<span class="token punctuation">.</span>isSuperhero <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    target<span class="token punctuation">.</span>power <span class="token operator">=</span> <span class="token string">'flight'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@superhero
<span class="token keyword">class</span> <span class="token class-name">MySuperHero</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>MySuperHero<span class="token punctuation">.</span>isSuperhero<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
</code></pre></div><p>我们还能再进一步，希望装饰器(Decorator)能够接受参数获取不同的行为，就像工厂方法那样:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">superhero</span><span class="token punctuation">(</span><span class="token parameter">isSuperhero</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        target<span class="token punctuation">.</span>isSuperhero <span class="token operator">=</span> isSuperhero<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@<span class="token function">superhero</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MySuperHeroClass</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>MySuperHeroClass<span class="token punctuation">.</span>isSuperhero<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>

@<span class="token function">superhero</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MySuperHeroClass</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>MySuperHeroClass<span class="token punctuation">.</span>isSuperhero<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>
</code></pre></div><p>ES2016的装饰器(Decorator)在属性和类上皆可工作。装饰器可以自动获取传入的<code>property name</code>、<code>target object</code>，我们稍后会讲到。装饰器(Decorator)里能拿到<code>descriptor</code>使得譬如：用getter替换属性获取、自动绑定等以前要很繁琐才能完成的工作变为可能。</p> <h3 id="es2016装饰器-decorator-和mixins"><a href="#es2016装饰器-decorator-和mixins" class="header-anchor">#</a> ES2016装饰器(Decorator)和Mixins</h3> <p>最近看Reg Braithwaite写<a href="http://raganwald.com/2015/06/26/decorators-in-es7.html" target="_blank" rel="noopener noreferrer">ES2016 Decorators as  mixins<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，以及之前的<a href="http://raganwald.com/2015/06/17/functional-mixins.html" target="_blank" rel="noopener noreferrer">Functional mixins<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，非常赞同他的观点。Reg通过一个Helper向任意target(class prototype 或者对象)中植入不同的行为，以此来表示一个具备指定行为的类。Functional mixin将不同的实例行为植入类的prototype中，实现参考如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mixin</span><span class="token punctuation">(</span><span class="token parameter">behaviour<span class="token punctuation">,</span> sharedBehaviour <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> instanceKeys <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>behaviour<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> sharedKeys <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>sharedBehaviour<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> typeTag <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'isa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">_mixin</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> property <span class="token keyword">of</span> instanceKeys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> property<span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> behaviour<span class="token punctuation">[</span>property<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> typeTag<span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> property <span class="token keyword">of</span> sharedKeys<span class="token punctuation">)</span><span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>_mixin<span class="token punctuation">,</span> property<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            value<span class="token operator">:</span> sharedBehaviour<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">,</span>
            enumerable<span class="token operator">:</span> sharedBehaviour<span class="token punctuation">.</span><span class="token function">propertyIsEnumerable</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>_mixin<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>hasInstance<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>i<span class="token punctuation">[</span>typeTag<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> _mixin<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>屌！现在我们可以定义mixins，然后用她们装饰其他类了。想象一下我们有以下简单<code>ComicBookCharacter</code>类：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">ComicBookCharacter</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">first<span class="token punctuation">,</span> last</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> first<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> last<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">realName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这估计是史上最无聊的角色了，不过我们可以定义一些mixins来给她提升一下能力，诸如<code>SuperPowers</code>、<code>UtilityBelt</code>。来试试用Reg的mixins Helper吧：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> SuperPowers <span class="token operator">=</span> <span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">addPower</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">powers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">powers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_powers_pocessed <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_powers_pocessed <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> UtilityBelt <span class="token operator">=</span> <span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">addToBelt</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">utilities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">utilities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_utility_items <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_utility_items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>有了这些，我们现在可以前缀<code>@</code>符号，把上述两个mixins作为装饰器(Decorator)挂在<code>ComicBookCharacter</code>上为其提供额外功能了。注意下面代码多装饰器(Decorators)是如何作用于类上的：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>@SuperPowers
@UtilityBelt
<span class="token keyword">class</span> <span class="token class-name">ComicBookCharacter</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">first<span class="token punctuation">,</span> last</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> first<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> last<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">realName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>好吧，我们现在要用上面定义好的类来创造一个蝙蝠侠喽：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> batman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComicBookCharacter</span><span class="token punctuation">(</span><span class="token string">'Bruce'</span><span class="token punctuation">,</span> <span class="token string">'Wayne'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>batman<span class="token punctuation">.</span><span class="token function">realName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Bruce Wayne</span>

batman<span class="token punctuation">.</span><span class="token function">addToBelt</span><span class="token punctuation">(</span><span class="token string">'batarang'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
batman<span class="token punctuation">.</span><span class="token function">addToBelt</span><span class="token punctuation">(</span><span class="token string">'cape'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>batman<span class="token punctuation">.</span><span class="token function">utilities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//['batarang', 'cape']</span>

batman<span class="token punctuation">.</span><span class="token function">addPower</span><span class="token punctuation">(</span><span class="token string">'detective'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
batman<span class="token punctuation">.</span><span class="token function">addPower</span><span class="token punctuation">(</span><span class="token string">'voice sounds like Gollum has asthma'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>batman<span class="token punctuation">.</span><span class="token function">powers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//['detective', 'voice sounds like Gollum has asthma']</span>
</code></pre></div><p>通过装饰器(Decorators)，代码更加简洁。我自己在使用过程中将她们作为函数调用的另一种选择，或者高阶函数组件的Helper。
注：@WebReflection也写了一个上述<code>mixin</code>的实现，你可以在<a href="https://gist.github.com/addyosmani/a0ccf60eae4d8e5290a0#comment-1489585" target="_blank" rel="noopener noreferrer">这儿<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>看看和Reg的版本有什么不同。</p> <h2 id="通过babel使用装饰器-decorators"><a href="#通过babel使用装饰器-decorators" class="header-anchor">#</a> 通过<code>Babel</code>使用装饰器(Decorators)</h2> <p>装饰器(Decorator)现仍处于提议阶段，没被通过列入标准。我们要感谢<code>Babel</code>提供了一个试验模式支持装饰器(Decorator)的转义实现，使得上述例子基本都可以直接使用。</p> <p>如果使用<code>Babel CLI</code>，传入如下参数即可：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>babel --optional es7.decorators
</code></pre></div><p>或者你可以自己写程序调用她的<code>transformer</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token string">'code'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    optional<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'es7.decorators'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>Babel</code>还有个在线版的<a href="https://babeljs.io/repl/" target="_blank" rel="noopener noreferrer">REPL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>；选中“Experimental”复选框就可以激活装饰器(Decorator)，来试试？</p> <h2 id="牛逼的各种实验"><a href="#牛逼的各种实验" class="header-anchor">#</a> 牛逼的各种实验</h2> <p>坐我旁边的是一个超走运的小伙儿，他叫Paul Lewis，用装饰器(Decorator)做了个<a href="https://github.com/GoogleChrome/samples/tree/gh-pages/decorators-es7/read-write" target="_blank" rel="noopener noreferrer">试验性的功能<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>重塑了读/写DOM的体验。其中借鉴了Wilson Page的FastDOM，不过提供了更简单的API接口。Paul的读/写装饰器(Decorator)甚至还能在<code>@write</code>执行时如果被装饰的函数内部有方法或者属性被调用来改变页面布局就会通过<code>console</code>警告你，同理当<code>@read</code>执行时如果有“写”类型的<code>DOM</code>变更也会收到警告。</p> <p>下面是Paul试验代码是简单使用场景，如果在<code>@read</code>里试图变更<code>DOM</code>时，就会有异常信息打在<code>console</code>里：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token punctuation">{</span>
    @read
    <span class="token function">readSomeStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'read'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//抛出异常</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token string">'100px'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @write
    <span class="token function">writeSomeStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'write'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//抛出异常</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="开始用装饰器-decorator-吧！"><a href="#开始用装饰器-decorator-吧！" class="header-anchor">#</a> 开始用装饰器(Decorator)吧！</h2> <p>简短地说，ES2016的装饰器对声明式的装饰、注解、类型检查以及在ES2015里类上增加装饰器的各种奇淫技巧都非常有好处。往深里说，对静态分析(编译时的类型检查，自动补全)也是大有裨益。</p> <p>她和经典的面向对象编程(OOP)里的装饰器也没有太大区别，OOP里是在对象上提供装饰器，或静态、或动态的植入不同行为，但却不改变原类。
装饰器的语义其实在<code>flux</code>中也有体现，无论如何，我们还是最好时刻关注Yehuda的更新。</p> <p>最近<code>React</code>社区也在讨论用装饰器替换之前的<a href="https://github.com/timbur/react-mixin-decorator" target="_blank" rel="noopener noreferrer">mixins<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>设计来创建高阶组件了。</p> <p>我个人看到这些试验性示例很是兴奋，希望你也能用<code>Babel</code>试一把，说不定你也搞出来点好玩的东东，然后像Paul一样分享给大家了。</p> <h2 id="更多阅读"><a href="#更多阅读" class="header-anchor">#</a> 更多阅读</h2> <ul><li><a href="https://github.com/wycats/javascript-decorators" target="_blank" rel="noopener noreferrer">https://github.com/wycats/javascript-decorators<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/jayphelps/core-decorators.js" target="_blank" rel="noopener noreferrer">https://github.com/jayphelps/core-decorators.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://blog.developsuperpowers.com/eli5-ecmascript-7-decorators/" target="_blank" rel="noopener noreferrer">http://blog.developsuperpowers.com/eli5-ecmascript-7-decorators/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://elmasse.github.io/js/decorators-bindings-es7.html" target="_blank" rel="noopener noreferrer">http://elmasse.github.io/js/decorators-bindings-es7.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://raganwald.com/2015/06/26/decorators-in-es7.html" target="_blank" rel="noopener noreferrer">http://raganwald.com/2015/06/26/decorators-in-es7.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://babeljs.io/repl/#?experimental=true&amp;evaluate=true&amp;loose=false&amp;spec=false&amp;playground=true&amp;code=class%20Foo%20%7B%0A%20%20%40function%20%28target%2C%20key%2C%20descriptor%29%20%7B%20%20%20%0A%20%20%20%20descriptor.writable%20%3D%20false%3B%20%0A%20%20%20%20return%20descriptor%3B%20%0A%20%20%7D%0A%20%20bar%28%29%20%7B%0A%20%20%20%20%0A%20%20%7D%0A%7D&amp;stage=0" target="_blank" rel="noopener noreferrer">Jay’s function expression ES2016 Decorators example<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>特别鸣谢：<a href="http://twitter.com/jayphelps" target="_blank" rel="noopener noreferrer">Jay Phelps<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="http://twitter.com/sebmck" target="_blank" rel="noopener noreferrer">Sebastian McKenzie<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="http://twitter.com/aerotwist" target="_blank" rel="noopener noreferrer">Paul Lewis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="http://twitter.com/surmair" target="_blank" rel="noopener noreferrer">Surma<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的意见
❤</p> <p>原文地址：<a href="https://medium.com/google-developers/exploring-es7-decorators-76ecb65fb841?from=timeline&amp;isappinstalled=1#.9q5s6et8h" target="_blank" rel="noopener noreferrer">exploring-es7-decorators<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#装饰器模式" title="装饰器模式">装饰器模式</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#es5、es2015-es6-里的装饰器-decorator" title="ES5、ES2015(ES6)里的装饰器(Decorator)">ES5、ES2015(ES6)里的装饰器(Decorator)</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#上手es2016的装饰器-decorator" title="上手ES2016的装饰器(Decorator)">上手ES2016的装饰器(Decorator)</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#装饰一个属性" title="装饰一个属性">装饰一个属性</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#装饰一个类" title="装饰一个类">装饰一个类</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#es2016装饰器-decorator-和mixins" title="ES2016装饰器(Decorator)和Mixins">ES2016装饰器(Decorator)和Mixins</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#通过babel使用装饰器-decorators" title="通过Babel使用装饰器(Decorators)">通过Babel使用装饰器(Decorators)</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#牛逼的各种实验" title="牛逼的各种实验">牛逼的各种实验</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#开始用装饰器-decorator-吧！" title="开始用装饰器(Decorator)吧！">开始用装饰器(Decorator)吧！</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#更多阅读" title="更多阅读">更多阅读</a></div></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.66fd165c.js" defer></script><script src="/assets/js/6.1b9a181a.js" defer></script><script src="/assets/js/4.718a8abf.js" defer></script><script src="/assets/js/33.9948fc6c.js" defer></script>
  </body>
</html>
