<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>以BDD手写依赖注入 | 右领军大都督</title>
    <meta name="description" content="程序编写过程中，常常面临的困境是写的时候行云流水，运行的时候捶胸捣腿！

那为什么会出现这种状况？编写习惯、或者说编写流程起了重要因素，譬如：没有测试用例——这表示你在编写时压根儿没想过时刻追踪编写内容的正确性、健壮性；也没考虑过程序如何适应来自PM的花样需求。

今天不谈理论，我们就来通过[BDD](https://en.wikipedia.org/wiki/Behavior-driven_de ...">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.ff698ad4.css" as="style"><link rel="preload" href="/assets/js/app.66fd165c.js" as="script"><link rel="preload" href="/assets/js/6.1b9a181a.js" as="script"><link rel="preload" href="/assets/js/4.718a8abf.js" as="script"><link rel="preload" href="/assets/js/32.7d842090.js" as="script"><link rel="prefetch" href="/assets/js/1.836aefc7.js"><link rel="prefetch" href="/assets/js/10.5978e5d8.js"><link rel="prefetch" href="/assets/js/11.ec890499.js"><link rel="prefetch" href="/assets/js/12.db7bcb86.js"><link rel="prefetch" href="/assets/js/13.a0678d0c.js"><link rel="prefetch" href="/assets/js/14.db66846d.js"><link rel="prefetch" href="/assets/js/15.2591b2da.js"><link rel="prefetch" href="/assets/js/16.80583441.js"><link rel="prefetch" href="/assets/js/17.0753be43.js"><link rel="prefetch" href="/assets/js/18.72780206.js"><link rel="prefetch" href="/assets/js/19.1d487c74.js"><link rel="prefetch" href="/assets/js/20.f0fe9a95.js"><link rel="prefetch" href="/assets/js/21.d80a0f41.js"><link rel="prefetch" href="/assets/js/22.4695553f.js"><link rel="prefetch" href="/assets/js/23.52e4eec9.js"><link rel="prefetch" href="/assets/js/24.bf9c9350.js"><link rel="prefetch" href="/assets/js/25.5eb98d81.js"><link rel="prefetch" href="/assets/js/26.17cf0ede.js"><link rel="prefetch" href="/assets/js/27.522aaf5a.js"><link rel="prefetch" href="/assets/js/28.f0f1746b.js"><link rel="prefetch" href="/assets/js/29.7185f335.js"><link rel="prefetch" href="/assets/js/30.84d20b8c.js"><link rel="prefetch" href="/assets/js/31.c51c0b21.js"><link rel="prefetch" href="/assets/js/33.9948fc6c.js"><link rel="prefetch" href="/assets/js/34.03615f5c.js"><link rel="prefetch" href="/assets/js/35.916ec328.js"><link rel="prefetch" href="/assets/js/36.573317d5.js"><link rel="prefetch" href="/assets/js/37.766086c8.js"><link rel="prefetch" href="/assets/js/38.b2d6547e.js"><link rel="prefetch" href="/assets/js/39.f52d00bf.js"><link rel="prefetch" href="/assets/js/40.fffe6b1e.js"><link rel="prefetch" href="/assets/js/41.d2951850.js"><link rel="prefetch" href="/assets/js/42.1d2dcebb.js"><link rel="prefetch" href="/assets/js/43.8e48cd61.js"><link rel="prefetch" href="/assets/js/44.8303cf21.js"><link rel="prefetch" href="/assets/js/45.39ad8d71.js"><link rel="prefetch" href="/assets/js/5.6e87a095.js"><link rel="prefetch" href="/assets/js/7.01c41c5e.js"><link rel="prefetch" href="/assets/js/8.b9ecde8b.js"><link rel="prefetch" href="/assets/js/9.a3929d94.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.da6e1ebe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ff698ad4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">右领军大都督 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">右领军大都督 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        以BDD手写依赖注入
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">Howard Zuo</span> <span itemprop="address">   in Shanghai</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2016-03-18T00:00:00.000Z">
      Fri Mar 18 2016
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-d832e844><a href="/tag/dependency injection" data-v-d832e844> dependency injection </a></li><li class="post-tag" data-v-d832e844><a href="/tag/BDD" data-v-d832e844> BDD </a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>程序编写过程中，常常面临的困境是写的时候行云流水，运行的时候捶胸捣腿！</p> <p>那为什么会出现这种状况？编写习惯、或者说编写流程起了重要因素，譬如：没有测试用例——这表示你在编写时压根儿没想过时刻追踪编写内容的正确性、健壮性；也没考虑过程序如何适应来自PM的花样需求。</p> <p>今天不谈理论，我们就来通过<a href="https://en.wikipedia.org/wiki/Behavior-driven_development" target="_blank" rel="noopener noreferrer">BDD<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>(行为驱动开发)的模式来完成一个类似<code>AngularJS</code>里<a href="https://docs.angularjs.org/guide/di" target="_blank" rel="noopener noreferrer">依赖注入<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的简单模块。通过这种方式，我们来感受一下<code>BDD</code>对于开发过程的帮助。</p> <h2 id="什么是bdd"><a href="#什么是bdd" class="header-anchor">#</a> 什么是BDD</h2> <blockquote><p><strong>BDD</strong>（行为驱动开发）是第二代的、由外及内的、基于拉(<strong>pull</strong>)的、多方利益相关者的(<strong>stakeholder</strong>)、多种可扩展的、高自动化的敏捷方法。它描述了一个交互循环，可以具有带有良好定义的输出（即工作中交付的结果）：已测试过的软件。</p></blockquote> <p>好吧，肯定有人会问“这他妈是人话么”。</p> <p>那我换个说法，我们需要这样一种编程方式，她从需求出发，描述模块使用的各个场景，并通过测试用例监督其行为；即便一开始无法完成所有预计功能，也可以通过迭代等方式持续交付；而且在需求变更时，也能通过测试用例来确认模块的健壮性。</p> <p>那么“测试用例”就是其中的关键，常见的BDD测试框架有：<a href="https://mochajs.org/" target="_blank" rel="noopener noreferrer">mocha<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<a href="http://jasmine.github.io/" target="_blank" rel="noopener noreferrer">jasmine<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。BDD测试框架的代码有极鲜明的声明式风格，代码是可“读”的！</p> <p>好了，废话不敢太多，我们这就打马上路。本章所涉源码在此：<a href="https://github.com/leftstick/naive-dependency-injection" target="_blank" rel="noopener noreferrer">naive-dependency-injection<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="创建项目"><a href="#创建项目" class="header-anchor">#</a> 创建项目</h2> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> simple-di<span class="token punctuation">;</span> <span class="token builtin class-name">cd</span> simple-di
<span class="token function">npm</span> init
</code></pre></div><blockquote><p><code>npm init</code>后，参考下图作答。我们这里使用<code>mocha</code>作为测试框架，所以<code>test command</code>必须为<code>mocha</code></p></blockquote> <img src="/images/bdd-01.png" alt="bdd"> <p>接着来，创建一个源码目录(src)；一个测试用例目录(test)：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> src <span class="token builtin class-name">test</span>
</code></pre></div><p>还有，既然在<code>npm init</code>时都声明了使用<code>mocha</code>作为测试命令，那不装一个<code>mocha</code>似乎也说不过去嘛：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev mocha
</code></pre></div><p>到此，各工作目录准备就绪，来试运行一下测试命令吧：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token builtin class-name">test</span>
</code></pre></div><blockquote><p>因为一个测试用例也没写，所以<code>0 passing</code>，完美，没毛病！</p></blockquote> <img src="/images/bdd-02.png" alt="bdd"> <h2 id="整装待发"><a href="#整装待发" class="header-anchor">#</a> 整装待发</h2> <p>准备测试用例：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">touch</span> test/ut.js
</code></pre></div><p>用你喜欢的工具打开<code>test/ut.js</code>，并写入如下内容：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> assert <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'assert'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token constant">DI</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../src/DI'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'test dependency injection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//TODO：这里后面我们会陆续加入各个cases</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="需求1：可以注入字面量"><a href="#需求1：可以注入字面量" class="header-anchor">#</a> 需求1：可以注入字面量</h3> <p>我们的第一个需求可以总结出如下特征：</p> <ul><li>她得是一个类(可被实例化)</li> <li>她得有一个注册方法，可以接受两个参数，分别是一个名字、一个字面量</li> <li>她还有一个运行方法，可以像<code>AngularJS</code>那样接受一个数组，数组的最后一项是即将被执行的函数，其余都是要被注入到执行函数里的实例名字</li></ul> <p>从需求出发，我们按照期待模块的“行为”，写出测试用例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'injecting literal object'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//她是一个类(可被实例化)</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//她有一个注册方法，可以接受两个参数，分别是一个名字、一个字面量</span>
    app<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'duck'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">fly</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'flying'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> msg<span class="token punctuation">;</span>
    <span class="token comment">//她有一个运行方法，接受一个数组，数组的最后一项是即将被执行的函数，其余都是要被注入到执行函数里的实例名字</span>
    app<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'duck'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        msg <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token string">'flying'</span><span class="token punctuation">,</span> <span class="token string">'字面量注入失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>将以上case放入之前准备好的<code>test/ut.js</code>的<code>TODO</code>位置</p></blockquote> <p>这时候，我们如果运行测试用例(<code>npm test</code>)，结果可想而知：</p> <img src="/images/bdd-03.png" alt="bdd"> <p>第一次解决问题的时候来了，根据错误描述，我们得知“<strong>Cannot find module '../src/DI'</strong>”，解决方法，异常简单，请看</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">touch</span> src/DI.js
</code></pre></div><p>再次运行测试用例(<code>npm test</code>)，得到如下结论:</p> <img src="/images/bdd-04.png" alt="bdd"> <p>这次的问题是“<strong>DI is not a function</strong>”，因为刚才我们仅仅创建了<code>src/DI.js</code>文件，并没有提供任何内容，所以当然<code>not a function</code>。那我们现在给<code>src/DI.js</code>提供一个<code>function</code>作为返回值吧：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">DI</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token constant">DI</span><span class="token punctuation">;</span>
</code></pre></div><p>继续运行测试用例(<code>npm test</code>)，看到如下结论:</p> <img src="/images/bdd-05.png" alt="bdd"> <p>这次是“<strong>app.register is not a function</strong>”，很好修复该问题，声明一下<code>register</code>方法不就好了么，顺便我们可以联想到<code>app.run</code>肯定也得<code>not a function</code>，也一起补了吧：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">DI</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> inst</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">DI</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>不骄不躁，我们再<code>npm test</code>一次：</p> <img src="/images/bdd-06.png" alt="bdd"> <p>总算入了正题，断言<code>assert.equal(msg, 'flying', '字面量注入失败');</code>失败了，因为我们只是声明了要用到的各个方法，并没有写任何实现，那么先从构造函数改起吧：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">DI</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//我们需要一个成员store来保存register方法注册的名字和其对应的实例</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>store <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>二来修改<code>register</code>方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">DI</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> inst</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//将名字和对应的实例存入store</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> inst<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>三来补充<code>run</code>方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">DI</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//1. 数组arr末尾元素的下标</span>
    <span class="token keyword">var</span> lastIndex <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">//2. 取出末尾元素，作为待执行函数</span>
    <span class="token keyword">var</span> cb <span class="token operator">=</span> arr<span class="token punctuation">[</span>lastIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//3. 取出除末尾元素的其它所有元素，为待注入的实例名字列表</span>
    <span class="token keyword">var</span> argsName <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//4. 将上述实例名字列表依次从store中获取对应的实例，组成真正待执行函数的参数列表</span>
    <span class="token keyword">var</span> args <span class="token operator">=</span> argsName<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//5. 执行第2步取出的函数，并传入第4步的到的参数</span>
    <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>来吧，是时候证明自己了：</p> <img src="/images/bdd-07.png" alt="bdd"> <h3 id="需求2：可以注入class"><a href="#需求2：可以注入class" class="header-anchor">#</a> 需求2：可以注入class</h3> <p>我们的第二个需求是在前一个基础上做增量：</p> <ul><li>她得有一个注册方法，可以接受两个参数，分别是一个名字、一个字面量<strong>或者<em>class</em></strong></li></ul> <p>有了新的需求，我们也得为新“行为”，添加测试用例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'injecting class'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//她依旧是一个类(可被实例化)</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">woman</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">cry</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'crying'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//她依旧有一个注册方法，只不过接受的实例也可以是class</span>
    app<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'woman'</span><span class="token punctuation">,</span> woman<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> msg<span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'woman'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">w</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        msg <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">cry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token string">'crying'</span><span class="token punctuation">,</span> <span class="token string">'failed injecting class'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>代码不改，想来也是不能工作的：</p> <img src="/images/bdd-08.png" alt="bdd"> <p>因为我们之前没适配过<code>class</code>注入的情况，所以这里注入的仅仅是<code>woman</code>的类声明，并非<code>instance</code>，所以需要对之前的实现进行调整。这时测试用例的好处就体现出来了，修改完<code>src/DI.js</code>后，只要再次<code>npm test</code>，轻轻松松证明实现是否满足了新需求，又不破坏原来的功能。</p> <p>我们需要调整的地方，仅仅是<code>register</code>方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">DI</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> inst</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> inst <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">inst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> inst<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>运行测试用例(<code>npm test</code>)后</p> <img src="/images/bdd-09.png" alt="bdd"> <p>再次happy</p> <h3 id="需求3：可以根据-inject属性注入实例"><a href="#需求3：可以根据-inject属性注入实例" class="header-anchor">#</a> 需求3：可以根据$inject属性注入实例</h3> <p>我们的第三个需求依旧是在前一个基础上做增量：</p> <ul><li>她有一个运行方法，可以像<code>AngularJS</code>那样接受一个待执行函数，而这个函数有一个<code>$inject</code>属性，该属性为数组，指定了要注入给待执行函数的实例名字列表</li></ul> <p>根据新需求，为新“行为”添加测试用例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'injecting with $inject attr'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//她依旧是一个类(可被实例化)</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">man</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">fight</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'fighting'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'man'</span><span class="token punctuation">,</span> man<span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">action</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'scratch'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> msg1<span class="token punctuation">,</span>
        msg2<span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">exec</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">w<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        msg1 <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg2 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    exec<span class="token punctuation">.</span>$inject <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'man'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//run方法接受一个函数，该函数的$inject属性声明了他的依赖</span>
    app<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>exec<span class="token punctuation">)</span><span class="token punctuation">;</span>

    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>msg1<span class="token punctuation">,</span> <span class="token string">'fighting'</span><span class="token punctuation">,</span> <span class="token string">'failed injecting with $inject attr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>msg2<span class="token punctuation">,</span> <span class="token string">'scratch'</span><span class="token punctuation">,</span> <span class="token string">'failed injecting with $inject attr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>运行测试用例(<code>npm test</code>)后，这当然是错的：</p> <img src="/images/bdd-10.png" alt="bdd"> <p>因为这次我们<code>run</code>的，压根不是个数组，而是一个附有<code>$inject</code>属性的函数，所以<code>src/DI.js</code>的<code>run</code>方法源码必须调整：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">DI</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> cb<span class="token punctuation">,</span>
        argsName<span class="token punctuation">,</span>
        args<span class="token punctuation">,</span>
        lastIndex <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">//传入数组时，一切照旧</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cb <span class="token operator">=</span> arr<span class="token punctuation">[</span>lastIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        argsName <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>$inject<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//传入函数，并附有$inject属性时，$inject就是argsName</span>
        cb <span class="token operator">=</span> arr<span class="token punctuation">;</span>
        argsName <span class="token operator">=</span> arr<span class="token punctuation">.</span>$inject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//剩下照旧</span>
    args <span class="token operator">=</span> argsName<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>又成功的迈进了一步，high不high？</p> <img src="/images/bdd-11.png" alt="bdd"> <h3 id="最后的需求：根据函数反射注入实例"><a href="#最后的需求：根据函数反射注入实例" class="header-anchor">#</a> 最后的需求：根据函数反射注入实例</h3> <p>我们的第四个需求也是终极需求，特征如下：</p> <ul><li>她有一个运行方法，可以像<code>AngularJS</code>那样接受一个待执行函数，并能仅根据函数本身注入正确的实例</li></ul> <p>没别的，先补充测试用例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'injecting with reflection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//她依旧是一个类(可被实例化)</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'woman'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">cry</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'crying'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'duck'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">fly</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'flying'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> msg1<span class="token punctuation">,</span>
        msg2<span class="token punctuation">;</span>
    <span class="token comment">//run方法接受一个函数，该函数仅在参数列表里以变量名表达了依赖关系</span>
    app<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">woman<span class="token punctuation">,</span> duck</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        msg1 <span class="token operator">=</span> woman<span class="token punctuation">.</span><span class="token function">cry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg2 <span class="token operator">=</span> duck<span class="token punctuation">.</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>msg1<span class="token punctuation">,</span> <span class="token string">'crying'</span><span class="token punctuation">,</span> <span class="token string">'failed injecting woman'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>msg2<span class="token punctuation">,</span> <span class="token string">'flying'</span><span class="token punctuation">,</span> <span class="token string">'failed injecting duck'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>不用怀疑，<code>npm test</code>之后，一定又错了！</p> <img src="/images/bdd-12.png" alt="bdd"> <p>回顾我们上一份实现，似乎并没有考虑<code>run</code>方法接受的“是一个函数，而且这个函数没有<code>$inject</code>属性”这种情况，理论上，再补一个路径选择就好了：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">DI</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> cb<span class="token punctuation">,</span>
        argsName<span class="token punctuation">,</span>
        args<span class="token punctuation">,</span>
        lastIndex <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">//传入数组时，一切照旧</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cb <span class="token operator">=</span> arr<span class="token punctuation">[</span>lastIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        argsName <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>$inject<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//传入函数，并附有$inject属性时，$inject就是argsName</span>
        cb <span class="token operator">=</span> arr<span class="token punctuation">;</span>
        argsName <span class="token operator">=</span> arr<span class="token punctuation">.</span>$inject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">//传入函数，又没有$inject属性时，通过toString反射函数体，利用正则表达式截取依赖列表</span>
        cb <span class="token operator">=</span> arr<span class="token punctuation">;</span>
        argsName <span class="token operator">=</span> arr
            <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/\(\s*([a-zA-Z,\s]*)\)/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> name<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    args <span class="token operator">=</span> argsName<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>世界终于清净下来了！！！</p> <img src="/images/bdd-13.png" alt="bdd"> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>本章内容就是利用BDD的开发模式，帮我们一步步抽丝剥茧，在需求不断变化的情况下有条不紊的通过重构代码来实现新的内容，而又不破坏之前已实现的逻辑。</p> <p>可以这么说，有了测试用例，理清BDD思路，妈妈再也不用担心你的代码重构了！</p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#什么是bdd" title="什么是BDD">什么是BDD</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#创建项目" title="创建项目">创建项目</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#整装待发" title="整装待发">整装待发</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#需求1：可以注入字面量" title="需求1：可以注入字面量">需求1：可以注入字面量</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#需求2：可以注入class" title="需求2：可以注入class">需求2：可以注入class</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#需求3：可以根据-inject属性注入实例" title="需求3：可以根据$inject属性注入实例">需求3：可以根据$inject属性注入实例</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#最后的需求：根据函数反射注入实例" title="最后的需求：根据函数反射注入实例">最后的需求：根据函数反射注入实例</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#总结" title="总结">总结</a></div></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.66fd165c.js" defer></script><script src="/assets/js/6.1b9a181a.js" defer></script><script src="/assets/js/4.718a8abf.js" defer></script><script src="/assets/js/32.7d842090.js" defer></script>
  </body>
</html>
