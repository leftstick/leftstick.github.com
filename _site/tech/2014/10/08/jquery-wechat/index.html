
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>用jQuery.wechat创建你的微信web应用</title>

    
    <meta name="description" content="">
    

    <meta name="author" content="Howard.Zuo">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimal-ui"/>
    
    
    <base href="/">
    

    
    <base href="/">
    

    <!-- materiallize styles -->
    <link href="/assets/themes/materiallize/css/materialize.min.css" rel="stylesheet">
    <!-- fontawesome styles -->
    <link href="/assets/themes/materiallize/css/font-awesome.min.css" rel="stylesheet">
    <!-- tooltipster styles -->
    <link href="/assets/themes/materiallize/css/tooltipster.css" rel="stylesheet">
    <!-- prism styles -->
    <link href="/assets/themes/materiallize/css/prism.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="/assets/themes/materiallize/css/style.css" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="/assets/themes/materiallize/js/html5shiv.js"></script>
      <script src="/assets/themes/materiallize/js/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/apple-touch-icon-114x114.png">

    <script type="text/javascript" src="/assets/themes/materiallize/js/modernizr.js"></script>

  </head>

  <body>

      <nav class="light-blue lighten-1" role="navigation">
          <div class="nav-wrapper container">
              <a id="logo-container" href="/" class="brand-logo">右领军大都督</a>
              <ul class="right hide-on-med-and-down">
                  
                  
                  


  
    
  
    
      
          
          <li><a href="/index.html" lang="HOME"></a></li>
          
      
    
  
    
      
          
          <li><a href="/archive.html" lang="ARCHIVE"></a></li>
          
      
    
  
    
      
          
          <li><a href="/categories.html" lang="CATEGORIES"></a></li>
          
      
    
  
    
      
          
          <li><a href="/tags.html" lang="TAGS"></a></li>
          
      
    
  



              </ul>

              <ul id="nav-mobile" class="side-nav">
                  
                  
                  


  
    
  
    
      
          
          <li><a href="/index.html" lang="HOME"></a></li>
          
      
    
  
    
      
          
          <li><a href="/archive.html" lang="ARCHIVE"></a></li>
          
      
    
  
    
      
          
          <li><a href="/categories.html" lang="CATEGORIES"></a></li>
          
      
    
  
    
      
          
          <li><a href="/tags.html" lang="TAGS"></a></li>
          
      
    
  



              </ul>
              <a href="#" data-activates="nav-mobile" class="button-collapse right"><i class="mdi-navigation-menu"></i></a>
          </div>
      </nav>
      
      <main>
          <div class="container">
              
<div class="row">
    <div class="col s12 m8">
        <h2><small>神马乱七八糟的微信API统统不用操心啦</small></h2>
        
<p>因为最近自己的产品要在微信公众号中推广，需要提供一些<code>有意义</code>的功能，于是被迫走上了支持微信这条不归路。</p>

<p>众所周知，腾讯是那样一个神奇的公司，他们的产品在商业上获得巨大成功，但技术上真的很难令人恭维，没有精益求精，只有能用就成，诺大一个公众号开发平台，我竟然找不到<code>真正的，关于web开发的</code>官方文档，有的就是个别示例，剩下的…呵呵，有一个叫<code>开发者交流互助</code>的东东了。</p>

<p><img src="/assets/images/wechat_doc.png" alt="" /></p>

<p>看完上面这个图后，有没有这样的感觉：</p>

<pre><code class="language-ini">A: 你知道老王家有几口人么？

B: 不知道，我就在大门口见过他老婆，估计就俩人吧？

C: 不会吧，那天看见还有个小孩儿进他们家，会不会是老王家孩子？

D: 唉！谁他妈都没去过老王家，也不认识老王，老王也不自我坦白，鬼才知道他们家几口人！
</code></pre>

<p>例子或许不那么恰当，但就是这么个道理，一群开发者在死去活来的摸索，还互相慰藉，就是永远得不到正确答案！o(∩_∩)o 哈哈</p>

<p>说了这么多，赶紧入正题，本期要讲的就是我痛苦中挣扎徘徊后写的<a href="http://leftstick.github.io/jquery-wechat/">jQuery.wechat</a>，一个提供了统一API的、基于<a href="http://api.jquery.com/Types/#Promise">jQuery.promise</a>的jQuery.plugin。希望能多少帮助到大家。</p>

<h4 id="section">首先，安装那是相当的简单</h4>

<pre><code class="language-bash">bower install --save jquery-wechat
</code></pre>

<blockquote>
  <p>如果不用bower的，自己从<a href="https://github.com/leftstick/jquery-wechat/archive/master.zip">Github</a>上下载、解压，那也是一样一样滴！</p>
</blockquote>

<h5 id="section-1">加载，那也是水一样的自然</h5>

<pre><code class="language-markup">&lt;script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="bower_components/jquery-wechat/dist/jquery-wechat.min.js"&gt;&lt;/script&gt;
</code></pre>

<blockquote>
  <p>你如果用了<code>amd</code>，<code>cmd</code>之类的延迟加载技术，想必你也是个行家，不用我再教你怎么配置了吧？</p>
</blockquote>

<h5 id="section-2">使用——简单、轻松、统一、爽！</h5>

<h6 id="jquerywechat">启用<code>jQuery.wechat</code>功能</h6>

<pre><code class="language-javascript">$.wechat.enable(); //So easy!
</code></pre>

<p>因为整个插件是基于<a href="http://api.jquery.com/Types/#Promise">jQuery.promise</a>的，所以你也可以给它一个链：</p>

<pre><code class="language-javascript">$.wechat.enable().done(function(){
    alert('已经启用成功');
}).fail(function(){
    alert('启用失败');
});
</code></pre>

<blockquote>
  <p>考虑到目前单页技术(<a href="http://en.wikipedia.org/wiki/Single-page_application">SPA</a>)的广泛应用，工具类的设计必须考虑<code>启用/停用</code>机制，否则可能引起未知错误。</p>
</blockquote>

<h6 id="section-3">隐藏/显示菜单</h6>

<pre><code class="language-javascript">$.wechat.hideMenu(); //隐藏菜单
$.wechat.showMenu(); //显示菜单
</code></pre>

<blockquote>
  <p>启用<code>jQuery.wechat</code>之后，就可以随意调用如<code>hideMenu</code>之类的方法了，无需将其他方法写入<code>enable</code>的<code>done</code>回调之中。<code>jQuery.wechat</code>的实现原理是，如果<code>jQuery.wechat</code>还没有启用成功，所有操作会进入排队，一旦启用成功后，则顺序执行；如果启用失败，则永远不会执行。</p>
</blockquote>

<h6 id="section-4">隐藏/显示底部工具栏</h6>

<pre><code class="language-javascript">$.wechat.hideToolbar(); //隐藏底部工具栏
$.wechat.showToolbar(); //显示底部工具栏
</code></pre>

<h6 id="section-5">打开扫描二维码界面</h6>

<pre><code class="language-javascript">$.wechat.scanQRcode();
</code></pre>

<h6 id="section-6">打开图片预览工具</h6>

<pre><code class="language-javascript">$.wechat.preview({
    current: 'http://xxx/img/pic001.jpg',  //进入预览模式后，直接显示这张图片
    urls: [
        'http://xxx/img/pic001.jpg',
        'http://xxx/img/pic002.jpg',
        'http://xxx/img/pic003.jpg',
        'http://xxx/img/pic004.jpg',
        'http://xxx/img/pic005.jpg',
        'http://xxx/img/pic006.jpg'
    ]                                      //所有要在预览模式下显示的图片
});
</code></pre>

<h6 id="section-7">获取网络状态</h6>

<pre><code class="language-javascript">$.wechat.getNetworkType().done(function(response) {
    $('#network').text(response.split(':')[1]); 
});
</code></pre>

<p><code>response</code>格式如下：</p>

<pre><code class="language-ini">network_type:wifi    wifi网络
network_type:edge    非wifi,包含3G/2G
network_type:fail    网络断开连接
network_type:wwan    (2g或者3g)
</code></pre>

<h6 id="section-8">修改分享格式</h6>

<p>每次看到别人的app分享出来的消息都带着精美的缩略图、适当的标题和描述，更有甚者消息下面还跟了一行小字指出该消息是由<code>谁</code>发送出来的；再看看你自己分享出去的消息，一个蓝色的默认空白图片，配着不搭调的标题，会不会奇怪是什么逻辑把他们塞进去的？</p>

<p>还好，咱们现在就来解决这个问题:</p>

<pre><code class="language-javascript">$.wechat.setShareOption({
    appid: 'xxxx',                                               //小标appid
    img_width: '60',
    img_height: '60',
    img_url: window.location.toString() + 'img/demo.jpg',        //缩略图
    title: 'DEMO',                                               //标题
    desc: 'The description is set from $.wechat.setShareOption', //描述
    link: function() {
        return window.location.toString();                       //消息分享出去后，用户点击消息打开的链接地址
    },
    callback: function(response) {
        alert(response);                                         //分享后的回调函数，常见的有成功和取消
    }
});
</code></pre>

<p>具体参考如下截图：</p>

<p><img src="/assets/images/share.png" alt="" /></p>

<blockquote>
  <p>该分享格式变更会影响<code>发送给朋友</code>、<code>分享到朋友圈</code>、<code>分享到微博</code>、<code>发送邮件</code>四项功能。当设置后，再点击右上角菜单键打开菜单后，选择前述四项中的任意一项，就能看到更改后的效果</p>
</blockquote>

<h6 id="section-9">关闭当前页</h6>

<pre><code class="language-javascript">$.wechat.closeWindow();
</code></pre>

<h6 id="jquerywechat-1">停用<code>jQuery.wechat</code>机制</h6>

<pre><code class="language-javascript">$.wechat.destroy();
</code></pre>

<blockquote>
  <p>停用后，所有功能自动重置回初始状态</p>
</blockquote>

<p>更多详情，参考<a href="https://github.com/leftstick/jquery-wechat">Github-Source</a></p>

<p>若要试用，请微信中打开<a href="http://leftstick.github.io/jquery-wechat/">jQuery.wechat-DEMO</a></p>



        <div class="right-align pagination-group">
            
                <a href="/tech/2014/09/21/request-emitter" class="btn waves-effect waves-light blue lighten-2" style="border-top-right-radius: 0; border-bottom-right-radius: 0;">
                    &larr; <span lang="PREVIOUS_BTN"></span>
                </a>
            
                <a href="/archive.html" class="btn waves-effect waves-light blue" style="border-radius: 0;" lang="ARCHIVE_BTN"></a>
            
                <a href="/tutorial/2015/04/10/theme-introduction" class="btn waves-effect waves-light blue lighten-2" style="border-top-left-radius: 0; border-bottom-left-radius: 0;">
                    <span lang="NEXT_BTN"></span> &rarr;
                </a>
            
        </div>
        
        <br/>
        <hr>

        


  <div class="ds-thread" data-thread-key="/tech/2014/10/08/jquery-wechat" data-title="用jQuery.wechat创建你的微信web应用" data-url="http://leftstick.gitcafe.io/tech/2014/10/08/jquery-wechat"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"leftstickgithub"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>




    </div>
    <div class="col m4 hide-on-small-only">
        <div class="card blue-grey darken-1 z-depth-2">
            <div class="card-content white-text">
              <span class="card-title">用jQuery.wechat创建你的微信web应用</span>
            </div>
            <div class="card-action blue-grey lighten-4">
                <span lang="CREATED_ON"></span> 2014-10-08
            </div>
        </div>

        <div class="card-panel grey lighten-5 z-depth-2">
            <div class="row valign-wrapper">
                <div class="col s12">
                    <i class="fa fa-server fa-lg grey-text text-darken-4"></i>&nbsp;&nbsp;<strong class="grey-text text-darken-4" lang="CATEGORIES"></strong>
                    <hr>
                    
                      
                      <a href="/categories.html#tech-ref" class="waves-effect waves-light btn tag deep-orange">
                          tech&nbsp;11
                      </a>
                      
                    
                </div>
            </div>
        </div>

        <div class="card-panel grey lighten-5 z-depth-2">
            <div class="row valign-wrapper">
                <div class="col s12">
                    <i class="fa fa-flag fa-lg grey-text text-darken-4"></i>&nbsp;&nbsp;<strong class="grey-text text-darken-4" lang="TAGS"></strong>
                    <hr>
                    
                      
                      <a href="/tags.html#web-ref" class="waves-effect waves-light btn tag deep-orange">
                          web&nbsp;4
                      </a>
                      
                      <a href="/tags.html#jQuery-plugin-ref" class="waves-effect waves-light btn tag deep-orange">
                          jQuery-plugin&nbsp;1
                      </a>
                      
                    
                </div>
            </div>
        </div>
    </div>
</div>

          </div>
      </main>

      <div class="goto-top hide-on-med-and-down">
          <i class="fa fa-chevron-up fa-2x"></i>
      </div>

      <footer class="page-footer" style="padding-top:0;">
          
          <div class="footer-copyright">
            <div class="container">
            &copy; 2016 Howard.Zuo, All rights reserved.
            <a class="grey-text text-lighten-4 right" href="https://github.com/leftstick/jekyll-materiallize/blob/master/LICENSE">MIT License</a>
            </div>
          </div>
      </footer>

      


      <!-- Placed at the end of the document so the pages load faster -->
      <script src="/assets/themes/materiallize/js/jquery-2.1.3.min.js"></script>
      <script src="/assets/themes/materiallize/js/materialize.min.js"></script>
      <script src="/assets/themes/materiallize/js/jquery.tooltipster.min.js"></script>
      <script src="/assets/themes/materiallize/js/prism.js"></script>
      <script src="/assets/themes/materiallize/js/prism.clojure.js"></script>
      <script src="/assets/lang/lang.js"></script>
      <script src="/assets/themes/materiallize/js/init.js"></script>
  </body>
</html>

